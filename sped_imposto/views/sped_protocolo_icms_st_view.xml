<?xml version="1.0" encoding="UTF-8"?>
<!--
    Copyright 2016 Taŭga Tecnologia - Aristides Caldeira <aristides.caldeira@tauga.com.br>
    License AGPL-3 or later (http://www.gnu.org/licenses/agpl)
-->
<odoo>

    <record model="ir.ui.view" id="sped_protocolo_icms_st_aliquota_tree" >
        <field name="name">sped.protocolo.icms.st.aliquota.tree</field>
        <field name="model">sped.protocolo.icms.aliquota</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <tree string="Alíquotas" editable="top">
                <field name="data_inicio" required="1" />
                <field name="estado_origem_id" options="{'no_create': True, 'no_open': True}" invisible="1" />
                <field name="estado_destino_id" options="{'no_create': True, 'no_open': True}" required="1" />
                <field name="al_icms_proprio_id" options="{'no_create': True, 'no_open': True}" required="1" />
                <field name="al_icms_st_id" options="{'no_create': True, 'no_open': True}" required="1" />
                <field name="al_fcp" />
                <field name="infadic" />
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="sped_protocolo_icms_st_form" >
        <field name="name">sped.protocolo.icms.st.form</field>
        <field name="model">sped.protocolo.icms</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <form string="Protocolo/Convênio ICMS" delete="true" create="true" edit="true">
                <sheet>
                    <field name="tipo" invisible="1" />
                    <div class="oe_title">
                        <h1>
                            <field name="descricao" required="1"/>
                        </h1>
                    </div>
                    <button type="object" name="atualizar_tabela" string="Preencher tabela com as alíquotas padrão e MVA ajustado" />
                    <notebook tabpos="left">
                        <page string="Estados para validade">
                            <field name="estado_ids">
                                <tree editable="top">
                                    <field name="code" />
                                    <field name="name" />
                                </tree>
                            </field>
                        </page>
                        <page string="Alíquotas">
                            <notebook>
                                <page string="Região Sul" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_pr)d, %(base.state_br_rs)d, %(base.state_br_sc)d])]}">
                                    <notebook>
                                        <page string="Paraná" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_pr)d])]}">
                                            <field name="aliquota_PR_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_pr)d}" />
                                        </page>
                                        <page string="Rio Grande do Sul" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_rs)d])]}">
                                            <field name="aliquota_RS_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_rs)d}" />
                                        </page>
                                        <page string="Santa Catarina" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_sc)d])]}">
                                            <field name="aliquota_SC_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_sc)d}" />
                                        </page>
                                    </notebook>
                                </page>
                                <page string="Região Sudeste" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ['estado_ids', 'child_of', [%(base.state_br_es)d, %(base.state_br_mg)d, %(base.state_br_rj)d, %(base.state_br_sp)d]]]}">
                                    <notebook>
                                        <page string="Espírito Santo" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_es)d])]}">
                                            <field name="aliquota_ES_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_es)d}" />
                                        </page>
                                        <page string="Minas Gerais" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_mg)d])]}">
                                            <field name="aliquota_MG_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_mg)d}" />
                                        </page>
                                        <page string="Rio de Janeiro" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_rj)d])]}">
                                            <field name="aliquota_RJ_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_rj)d}" />
                                        </page>
                                        <page string="São Paulo" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_sp)d])]}">
                                            <field name="aliquota_SP_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_sp)d}" />
                                        </page>
                                    </notebook>
                                </page>
                                <page string="Região Centro-Oeste" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ['estado_ids', 'child_of', [%(base.state_br_df)d, %(base.state_br_go)d, %(base.state_br_mt)d, %(base.state_br_ms)d]]]}">
                                    <notebook>
                                        <page string="Distrito Federal" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_df)d])]}">
                                            <field name="aliquota_DF_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_df)d}" />
                                        </page>
                                        <page string="Goiás" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_go)d])]}">
                                            <field name="aliquota_GO_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_go)d}" />
                                        </page>
                                        <page string="Mato Grosso" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_mt)d])]}">
                                            <field name="aliquota_MT_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_mt)d}" />
                                        </page>
                                        <page string="Mato Grosso do Sul" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_ms)d])]}">
                                            <field name="aliquota_MS_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_ms)d}" />
                                        </page>
                                    </notebook>
                                </page>
                                <page string="Região Nordeste" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ['estado_ids', 'child_of', [%(base.state_br_al)d, %(base.state_br_ba)d, %(base.state_br_ce)d, %(base.state_br_ma)d, %(base.state_br_pb)d, %(base.state_br_pe)d, %(base.state_br_pi)d, %(base.state_br_rn)d, %(base.state_br_se)d]]]}">
                                    <notebook>
                                        <page string="Alagoas" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_al)d])]}">
                                            <field name="aliquota_AL_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_al)d}" />
                                        </page>
                                        <page string="Bahia" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_ba)d])]}">
                                            <field name="aliquota_BA_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_ba)d}" />
                                        </page>
                                        <page string="Ceará" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_ce)d])]}">
                                            <field name="aliquota_CE_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_ce)d}" />
                                        </page>
                                        <page string="Maranhão" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_ma)d])]}">
                                            <field name="aliquota_MA_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_ma)d}" />
                                        </page>
                                        <page string="Paraíba" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_pb)d])]}">
                                            <field name="aliquota_PB_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_pb)d}" />
                                        </page>
                                        <page string="Pernambuco" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_pe)d])]}">
                                            <field name="aliquota_PE_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_pe)d}" />
                                        </page>
                                        <page string="Piauí" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_pi)d])]}">
                                            <field name="aliquota_PI_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_pi)d}" />
                                        </page>
                                        <page string="Rio Grande do Norte" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_rn)d])]}">
                                            <field name="aliquota_RN_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_rn)d}" />
                                        </page>
                                        <page string="Sergipe" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_se)d])]}">
                                            <field name="aliquota_SE_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_se)d}" />
                                        </page>
                                    </notebook>
                                </page>
                                <page string="Região Norte" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ['estado_ids', 'child_of', [%(base.state_br_ac)d, %(base.state_br_ap)d, %(base.state_br_am)d, %(base.state_br_pa)d, %(base.state_br_ro)d, %(base.state_br_rr)d, %(base.state_br_to)d]]]}">
                                    <notebook>
                                        <page string="Acre" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_ac)d])]}">
                                            <field name="aliquota_AC_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_ac)d}" />
                                        </page>
                                        <page string="Amapá" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_ap)d])]}">
                                            <field name="aliquota_AP_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_ap)d}" />
                                        </page>
                                        <page string="Amazonas" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_am)d])]}">
                                            <field name="aliquota_AM_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_am)d}" />
                                        </page>
                                        <page string="Pará" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_pa)d])]}">
                                            <field name="aliquota_PA_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_pa)d}" />
                                        </page>
                                        <page string="Rondônia" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_ro)d])]}">
                                            <field name="aliquota_RO_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_ro)d}" />
                                        </page>
                                        <page string="Roraima" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_rr)d])]}">
                                            <field name="aliquota_RR_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_rr)d}" />
                                        </page>
                                        <page string="Tocantins" attrs="{'invisible': ['!', ['estado_ids', 'child_of', []], '!', ('estado_ids', 'child_of', [%(base.state_br_to)d])]}">
                                            <field name="aliquota_TO_ids" nolabel="1" colspan="4" context="{'tree_view_ref': 'sped.sped_protocolo_icms_st_aliquota_tree', 'default_estado_origem_id': %(base.state_br_to)d}" />
                                        </page>
                                    </notebook>
                                </page>
                            </notebook>
                        </page>
                        <page string="Categorias">
                            <separator string="Categorias de produtos e serviços" />
                            <field name="categ_ids"/>
                        </page>
                        <page string="NCMs e MVAs">
                            <table style="width:100%;">
                                <tr>
                                    <td style="width:19%;"><label for="ncm" /></td>
                                    <td style="width:1%;"></td>
                                    <td style="width:19%;"><label for="ex" /></td>
                                    <td style="width:1%;"></td>
                                    <td style="width:19%;"><label for="mva" /></td>
                                    <td style="width:1%;"></td>
                                    <td style="width:19%;"></td>
                                    <td style="width:1%;"></td>
                                    <td style="width:20%;"></td>
                                </tr>
                                <tr>
                                    <td style="width:19%;"><field name="ncm" /></td>
                                    <td style="width:1%;"></td>
                                    <td style="width:19%;"><field name="ex" /></td>
                                    <td style="width:1%;"></td>
                                    <td style="width:19%;"><field name="mva" /></td>
                                    <td style="width:1%;"></td>
                                    <td style="width:19%;"><button type="object" name="insere_ncm" string="Incluir NCMs e MVAs" attrs="{'invisible': ['|', ('ncm', '=', False)]}" /></td>
                                    <td style="width:1%;"></td>
                                    <td style="width:20%;"><button type="object" name="exclui_ncm" string="Excluir NCMs" attrs="{'invisible': ['|', ('ncm', '=', False)]}" /></td>
                                </tr>
                            </table>
                            <separator string="NCMs e MVAs" />
                            <field name="ncm_ids" nolabel="1" readonly="1">
                                <tree>
                                    <field name="ncm_id" />
                                    <field name="mva" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="sped_protocolo_icms_st_tree">
        <field name="name">sped.protocolo.icms.st.tree</field>
        <field name="model">sped.protocolo.icms</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <tree string="Protocolo/Convênio ICMS" delete="true" create="true" edit="true">
                <field name="tipo" invisible="1" />
                <field name="descricao" />
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="sped_protocolo_icms_st_search">
        <field name="name">sped.protocolo.icms.st.search</field>
        <field name="model">sped.protocolo.icms</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <search string="Protocolo/Convênio ICMS">
                <field name="descricao" />
            </search>
        </field>
    </record>

    <record model="ir.actions.act_window" id="sped_protocolo_icms_st_acao">
        <field name="name">Protocolo/Convênio ICMS</field>
        <field name="domain">[('tipo', '=', 'S')]</field>
        <field name="context">{'default_tipo': 'S'}</field>
        <field name="res_model">sped.protocolo.icms</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record model="ir.actions.act_window.view" id="sped_protocolo_icms_st_form_acao">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="sped_protocolo_icms_st_form"/>
        <field name="act_window_id" ref="sped_protocolo_icms_st_acao"/>
    </record>

    <record model="ir.actions.act_window.view" id="sped_protocolo_icms_st_tree_acao">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="sped_protocolo_icms_st_tree"/>
        <field name="act_window_id" ref="sped_protocolo_icms_st_acao"/>
    </record>

    <menuitem
        parent="menu_sped_aliquota_icms_st"
        sequence="1"
        id="menu_sped_protocolo_icms_st"
        name="Protocolo/Convênio"
        action="sped_protocolo_icms_st_acao" />

</odoo>
